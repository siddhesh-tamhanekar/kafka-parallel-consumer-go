<!DOCTYPE html>
<html>
<head>
  <title>Kafka Parallel Consumer Dashboard</title>
  <style>
    .consumer {
      border: 1px solid #ccc;
      margin-bottom: 20px;
      padding: 10px;
    }

    .buffer-slot {
      width: 20px;
      height: 20px;
      margin: 2px;
      display: inline-block;
      border: 1px solid #aaa;
    }

    .pending { background-color: #3498db; } /* Blue */
    .done { background-color: #2ecc71; }    /* Green */
    .empty { background-color: white; }

    .head { border-top: 3px solid red; }
    .tail { border-bottom: 3px solid orange; }

    .status-line {
      font-size: 14px;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h2>Kafka Consumer Dashboard</h2>
  <div id="dashboard"></div>

  <script>
    const dashboard = document.getElementById('dashboard');
    const consumers = {};

    const evtSource = new EventSource('/sse'); // Your SSE endpoint

    evtSource.onmessage = function(event) {
      const data = JSON.parse(event.data);
      const key = data.key;

      if (!consumers[key]) {
        const div = document.createElement('div');
        div.id = `consumer-${key}`;
        div.className = 'consumer';
        dashboard.appendChild(div);
        consumers[key] = div;
      }

      renderConsumer(consumers[key], data);
    };

    function renderConsumer(div, data) {
      const bufferHTML = data.buffer.map((val, i) => {
        let cls = 'buffer-slot ';
        if (val === null) cls += 'empty';
        else if (val === 0) cls += 'pending';
        else if (val === 1) cls += 'done';

        if (i === data.Head) cls += ' head';
        if (i === data.Tail) cls += ' tail';

        return `<div class="${cls}"></div>`;
      }).join('');

      div.innerHTML = `
        <h3>Consumer [${data.key}]</h3>
        <div class="status-line">
          Status: ${data.status} | Concurrency: ${data.max_concurrency} | Active Jobs: ${data.active_jobs} | Memory: ${data.memory_mb.toFixed(2)} MB |Messsage: ${data.message}
        </div>
        <div>${bufferHTML}</div>
      `;
    }
  </script>
</body>
</html>
